title: Detecting export stolen DPAPI backup keys
id: 7892ec59-c5bb-496d-8968-e5d210ca3ac4
related:
    -   id: 7892ec59-c5bb-496d-8968-e5d210ca3ac4
status: experimental
description: 'Detecting exported DPAPI backup keysDPAPI Backup Key Theft: Both Mimikatz and DSInternals export stolen DPAPI backup keys into files with the following name format:
        ntds_capi_*.pfx
        ntds_capi_*.pvk'
references:
    - https://www.dsinternals.com/en/dpapi-backup-key-theft-auditing/
author: Nounou Mbeiri
date: 2024/04/15
tags:
    - attack.t1555
    - attack.t1552.004
logsource:
    product: windows
    category: file_event
detection:
    selection_1:
        TargetFilename|contains: 'ntds_capi_'
        TargetFilename|endswith: '.pfx'
    selection_2:
            TargetFilename|contains: 'ntds_capi_'
            TargetFilename|endswith: '.pvk'
    condition: 1 of selection_*
falsepositives:
    - Unlikely
level: high
